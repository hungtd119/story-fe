<div *ngIf="story$ | async as story">
  <nz-page-header nzTitle="Story Detail"></nz-page-header>
  <nz-page-header-content class="grid grid-cols-1 gap-4">
    <div class="grid grid-cols-2 gap-2">
      <div>
        <nz-ribbon
          *ngIf="story.id"
          [nzText]="'ID ' + story.id.toString()"
          nzColor="red"
        >
          <nz-card
            class="w-100 grid grid-cols-1 gap-2"
            nzTitle="Story information"
          >
            <form
              nz-form
              [nzLayout]="'vertical'"
              [formGroup]="validateFormStoryInfo"
              (ngSubmit)="submitStoryInfo()"
            >
              <nz-form-item>
                <nz-form-label nzRequired="true" class="font-bold"
                  >Title</nz-form-label
                >
                <nz-form-control nzErrorTip="Please input story title!">
                  <nz-input-group>
                    <input
                      formControlName="title"
                      nz-input
                      placeholder="Title"
                    />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
              <div class="grid grid-cols-2 gap-2">
                <nz-form-item>
                  <nz-form-label nzRequired="true" class="font-bold"
                    >Level</nz-form-label
                  >
                  <nz-form-control nzErrorTip="Please input story level!">
                    <nz-input-group>
                      <input
                        formControlName="level"
                        nz-input
                        placeholder="Level"
                      />
                    </nz-input-group>
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzRequired="true" class="font-bold"
                    >Coin</nz-form-label
                  >
                  <nz-form-control nzErrorTip="Please input story Coin!">
                    <nz-input-group>
                      <input
                        formControlName="coin"
                        nz-input
                        placeholder="Coin"
                      />
                    </nz-input-group>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div class="grid grid-cols-2 gap-2">
                <nz-form-item>
                  <nz-form-label class="font-bold">Created at</nz-form-label>
                  <nz-form-control>
                    <nz-input-group>
                      <input
                        nz-input
                        [placeholder]="story.created_at"
                        readonly
                      />
                    </nz-input-group>
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label class="font-bold">Updated at</nz-form-label>
                  <nz-form-control>
                    <nz-input-group>
                      <input
                        nz-input
                        [placeholder]="story.updated_at"
                        readonly
                      />
                    </nz-input-group>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <nz-form-item>
                <nz-form-control>
                  <button
                    nz-button
                    nzType="primary"
                    [disabled]="!validateFormStoryInfo.valid"
                  >
                    Update
                  </button>
                </nz-form-control>
              </nz-form-item>
            </form>
          </nz-card>
        </nz-ribbon>
      </div>
      <div>
        <nz-card nzTitle="Information creator, illustrator">
          <form
            nz-form
            [nzLayout]="'vertical'"
            [formGroup]="validateFormCreator"
            (ngSubmit)="submitFormCreator()"
          >
            <div class="grid grid-cols-2 gap-2">
              <nz-form-item>
                <nz-form-label class="font-bold" nzRequired="true"
                  >Name creator</nz-form-label
                >
                <nz-form-control>
                  <nz-input-group>
                    <input nz-input formControlName="author" />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label class="font-bold" nzRequired="true"
                  >Name illustrator</nz-form-label
                ><nz-form-control>
                  <nz-input-group>
                    <input nz-input formControlName="illustrator" />
                  </nz-input-group>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-control>
                  <button
                    nz-button
                    nzType="primary"
                    [disabled]="!validateFormCreator.valid"
                  >
                    Update
                  </button>
                </nz-form-control>
              </nz-form-item>
            </div>
          </form>
        </nz-card>
      </div>
    </div>
    <div *ngIf="pages$ | async as pages">
      <nz-card nzTitle="Pages information" [nzExtra]="actionPage">
        <table class="table table-hover table-bordered w-100">
          <thead>
            <tr class="text-center">
              <th scope="col" class="w-1">Page Id</th>
              <th scope="col">Meta</th>
              <th scope="col">Content</th>
              <th scope="col">Interactions</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let page of pages" class="my-2">
              <th class="text-center text-sm">[{{ page.id }}]</th>
              <td>
                <table>
                  <tr>
                    <td class="text-sm font-bold">Number :</td>
                    <td class="text-sm px-2 py-[2px]">
                      {{ page.page_number }}
                    </td>
                  </tr>
                  <tr>
                    <td class="text-sm font-bold">Image id :</td>
                    <td class="text-sm px-2 py-[2px]">{{ page.image_id }}</td>
                  </tr>
                  <tr>
                    <td class="text-sm font-bold">Created at :</td>
                    <td class="text-sm px-2 py-[2px]">
                      {{ page.created_at | date : "short" }}
                    </td>
                  </tr>
                  <tr>
                    <td class="text-sm font-bold">Updated at :</td>
                    <td class="text-sm px-2 py-[2px]">
                      {{ page.updated_at | date : "short" }}
                    </td>
                  </tr>
                </table>
              </td>
              <td>
                <table>
                  <tr *ngFor="let text of page.texts; let i = index">
                    <td class="text-xs font-bold">Text[{{ i }}] :</td>
                    <td class="text-sm px-2 py-[2px]">
                      {{ text.text }}
                    </td>
                  </tr>
                </table>
              </td>
              <td class="font-bold text-center">
                {{ page.interactions_count }}
              </td>
              <td>
                <div class="d-flex justify-center">
                  <button nz-button nzType="default" nzShape="circle">
                    <span nz-icon nzType="select"></span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-center">
          <nz-pagination
            [nzPageIndex]="pageIndex"
            [nzTotal]="pageCount$ | async"
            [nzPageSize]="perPageSize"
            nzShowSizeChanger
            [nzPageSizeOptions]="[2, 4, 8, 10]"
            (nzPageIndexChange)="handleChangePageIndex($event)"
            (nzPageSizeChange)="handleChangePerPageSize($event)"
          ></nz-pagination>
        </div>
      </nz-card>
      <ng-template #actionPage>
        <div class="d-flex justify-center">
          <button
            nz-button
            nzType="default"
            nzShape="circle"
            (click)="gotoConfigPages(story.id, pages[0].id)"
          >
            <span nz-icon nzType="edit"></span>
          </button>
        </div>
      </ng-template>
    </div>
  </nz-page-header-content>
</div>
